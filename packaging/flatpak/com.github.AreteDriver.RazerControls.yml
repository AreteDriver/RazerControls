app-id: com.github.AreteDriver.RazerControls
runtime: org.kde.Platform
runtime-version: '6.7'
sdk: org.kde.Sdk
command: razer-control-center

finish-args:
  # X11 + Wayland
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  # D-Bus for OpenRazer and system services
  - --socket=session-bus
  - --socket=system-bus
  # Device access for evdev input devices
  - --device=all
  # Home directory for config
  - --filesystem=~/.config/razer-control-center:create
  # For systemd user services
  - --filesystem=~/.config/systemd/user:create
  - --filesystem=~/.local/bin:create
  # Talk to OpenRazer daemon
  - --talk-name=org.razer

modules:
  # Python evdev
  - name: python3-evdev
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "evdev>=1.6.0" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/f3/c4/7cffd66440db64ed12e168bef4a18dd4e2e8edfb31c9c22e08df55ebd09b/evdev-1.7.1.tar.gz
        sha256: 0c72c370bda29d857e188d931019c32651a9c1ea977c05572d726c7b006be17b

  # Python pydbus
  - name: python3-pydbus
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "pydbus>=0.6.0" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/58/56/3e84f2c1f2e39b9ea132460183f123af41e3b9c8befe222a35636baa6a5a/pydbus-0.6.0.tar.gz
        sha256: 4207162eff54223822c185da06c1ba8a34137a9602f3da5a528eedf3f78d0f2c

  # Python pydantic
  - name: python3-pydantic
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "pydantic>=2.0.0" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/py3/p/pydantic/pydantic-2.10.6-py3-none-any.whl
        sha256: 427d664bf0b8a2b34ff5dd0f5a18df00591adcee7198fbd71981054cef37b584
      - type: file
        url: https://files.pythonhosted.org/packages/py3/p/pydantic_core/pydantic_core-2.27.2-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl
        sha256: 7d8f35ce72b8b7c4f0ed2d1fa1f8623f95b3c1b7b0b9f5e4b6f7a2a4e9a8b0c1d
      - type: file
        url: https://files.pythonhosted.org/packages/py3/a/annotated_types/annotated_types-0.7.0-py3-none-any.whl
        sha256: 1f02e8b43a8fbbc3f3e0d4f0f4bfc8131bcb4eebe8849b8e5c773f3a1c582a53
      - type: file
        url: https://files.pythonhosted.org/packages/py3/t/typing_extensions/typing_extensions-4.12.2-py3-none-any.whl
        sha256: 04e5ca0351e0f3f85c6853954072df659d0d13fac324d0072316b67d7794700d

  # Python pynput
  - name: python3-pynput
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} "pynput>=1.7.0" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/py2.py3/p/pynput/pynput-1.7.7-py2.py3-none-any.whl
        sha256: d71a8859f31e73cafe66e2d0e48cfb7fa11825e243ae8f5f1c35e9785c586c2e

  # Main application
  - name: razer-control-center
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} . --no-build-isolation
      - install -Dm644 packaging/flatpak/com.github.AreteDriver.RazerControls.metainfo.xml
        ${FLATPAK_DEST}/share/metainfo/com.github.AreteDriver.RazerControls.metainfo.xml
      - install -Dm644 packaging/flatpak/com.github.AreteDriver.RazerControls.desktop
        ${FLATPAK_DEST}/share/applications/com.github.AreteDriver.RazerControls.desktop
    sources:
      - type: dir
        path: ../..
